# AI编程文档规范


## 一、规范说明

**核心理念**：
```
AI需要的不是"完整的知识库"，而是"精准的上下文"
```

---

## 二、核心原则

### 1. 信息密度优先

**规则**：每一行都必须被读到

- 避免冗余和废话，选择合适的表现形式
- 长段落叙述 → 表格/列表/伪代码/流程图

### 2. 模块化原则

**规则**：单个文档行数控制在合理范围内

| 文档类型 | 推荐行数 | 最大行数 | 原因 |
|---------|---------|---------|------|
| 页面/模块文档 | 150-300行 | 500行 | AI上下文窗口限制 |
| 通用规范文档 | 200-400行 | 800行 | 需要包含完整映射表 |
| 专项深入文档 | 300-600行 | 1000行 | 复杂机制需要详细说明 |
| API接口文档 | 每个接口50-100行 | 200行 | 单个接口的完整定义 |

**✅ 好的例子**：
```
docs/
├── modules/
│   ├── 01-认证与权限.md        (200行)
│   ├── 02-代理商管理.md        (300行)
│   └── 03-OAuth授权.md         (200行)
```

**❌ 坏的例子**：
```
docs/
└── 后端实现指南.md              (3192行) ← AI容易丢失关键信息
```

### 3. 单一职责原则

**规则**：一个文档只描述一个模块/页面/功能

**✅ 好的例子**：
- `pages/用户管理.md` - 只描述用户管理页面
- `modules/OAuth授权.md` - 只描述OAuth授权模块

**❌ 坏的例子**：
- `前端实现指南.md` - 包含9个页面（2456行）
- `后端实现指南.md` - 包含8个模块（3192行）

### 4. 精准相关原则

**规则**：AI上下文中的每一行都应该与当前任务相关

**使用场景示例**：

```
开发任务：实现用户登录功能

✅ 好的上下文组合（总计 ~400行）：
  01-系统模型.md#权限体系 (50行)
  modules/01-认证与权限.md (200行)
  api/api-01-认证.md#登录接口 (50行)
  02-数据库设计.md#users表 (30行)

❌ 坏的上下文组合（总计 3192行）：
  03-后端实现指南.md (3192行)
    ├─ 包含登录逻辑 (需要) ✅
    ├─ 包含代理商管理 (不需要) ❌
    ├─ 包含日志拉取 (不需要) ❌
    └─ 包含导出任务 (不需要) ❌
```

### 5. 可视化优先原则

**规则**：用图表代替大段文字描述

**选择原则**：

| 内容类型 | 推荐形式 | 适用场景 |
|---------|---------|---------|
| 对比、分类、枚举 | 表格 | 多维度对比、配置项、映射关系 |
| 步骤、要点、清单 | 列表 | 线性流程、要点总结 |
| 算法逻辑、条件分支 | 伪代码 | 复杂逻辑、算法步骤 |
| 时序、状态转换 | 流程图 | 多路径流程、状态机 |

**示例**：

```markdown
## 界面布局（推荐用ASCII图）

```
┌─────────────────────────────────┐
│ 用户管理            [新增用户]  │
├─────────────────────────────────┤
│ 表格：                          │
│ ┌────┬────┬────┬──────────┐   │
│ │ ID │姓名│角色│ 操作     │   │
│ └────┴────┴────┴──────────┘   │
└─────────────────────────────────┘
```
```

### 6. 完全自洽原则

**规则**：AI 读一个文档就能独立工作

- 必要信息直接包含，不依赖隐性假设
- 第三方官方文档可外链，但核心信息必须内嵌

### 7. 交叉引用原则

**规则**：文档间通过链接互相引用，而不是重复内容

**✅ 好的例子**：
```markdown
## 权限验证

> **详细定义**: 见 [01-系统模型.md#权限体系](../01-系统模型.md#权限体系)

**验证流程**：
- SUPER_ADMIN：直接放行
- ADMIN：直接放行
- USER：检查user_agency_binding表
```

**❌ 坏的例子**：
```markdown
## 权限验证

权限体系分为三层：
- SUPER_ADMIN：全局唯一，不可删除，不可修改角色...（复制粘贴500行）
- ADMIN：...
- USER：...
```

---

## 三、文档架构

### 分层架构

```
Layer 1: 基础层（理解系统）
  ├─ 00-快速导航.md              快速索引，找到目标文档
  ├─ 01-系统模型.md              核心概念、实体关系
  └─ 02-数据库设计.md            数据结构

Layer 2: 实现层（具体实现）
  ├─ backend/modules/            后端模块文档（8-10个）
  ├─ frontend/pages/             前端页面文档（9个）
  └─ api/                        API接口文档（按模块拆分）

Layer 3: 专项层（深入机制）
  ├─ advanced/                   复杂机制深入文档
  └─ external/                   外部系统对接文档
```

### AI使用策略

| 开发场景 | Layer 1 | Layer 2 | Layer 3 | 总行数 |
|---------|---------|---------|---------|--------|
| 快速了解系统 | ✅ 全部 | ❌ | ❌ | ~600行 |
| 实现单个模块 | ✅ 相关部分 | ✅ 该模块 | ❌ | ~400行 |
| 实现复杂功能 | ✅ 相关部分 | ✅ 该模块 | ✅ 相关专项 | ~800行 |
| 修复Bug | ❌ | ✅ 相关模块 | ✅ 可能需要 | ~500行 |

**目标**: 控制在 **1000行以内**

### 目录结构与命名

```
docs/
├─── 00-快速导航.md              ← 数字前缀表示阅读顺序
├─── 01-系统模型.md
├─── 02-数据库设计.md
├─── backend/
│    ├─── modules/
│    │    ├─── 01-认证与权限.md  ← 模块编号对应错误码
│    │    ├─── 02-代理商管理.md
│    │    └─── ...
│    └─── advanced/
│         └─── 日志拉取任务管理.md  ← 专项文档用中文描述性名称
├─── frontend/
│    └─── pages/
│         ├─── 登录页.md         ← 页面名称
│         ├─── 用户管理.md
│         └─── ...
└─── api/
     ├─── api-01-认证.md         ← 对应后端模块编号
     └─── ...
```

| 文档类型 | 命名格式 | 示例 |
|---------|---------|------|
| 基础文档 | `数字-名称.md` | `01-系统模型.md` |
| 模块文档 | `数字-模块名.md` | `03-OAuth授权.md` |
| 页面文档 | `页面名.md` | `用户管理.md` |
| API文档 | `api-数字-模块名.md` | `api-01-认证.md` |
| 专项文档 | `功能描述.md` | `日志拉取任务管理.md` |

---

## 四、前后端文档规范

### 前端文档

```
前端文档 = 产品设计稿 + 交互说明书 ≠ 技术实现手册
```

| 应该写什么 | 不应该写什么 |
|-----------|------------|
| ✅ 界面布局图（ASCII图） | ❌ Vue组件代码 |
| ✅ 用户交互流程 | ❌ 状态管理实现 |
| ✅ 表单字段定义 | ❌ 表单验证代码 |
| ✅ 调用哪个API | ❌ Axios封装逻辑 |
| ✅ 枚举值映射表 | ❌ 工具函数实现 |
| ✅ 按钮权限规则 | ❌ 路由守卫代码 |

**为什么？** AI擅长根据需求生成代码，需要清晰的界面要求和交互流程，不需要具体的技术实现细节。

**前端页面文档模板**：

```markdown
# 页面名称

**路由** | **权限** | **后端接口**

## 界面布局（ASCII图）
## 交互流程（用户操作流程图）
## 字段/组件清单（表格定义）
## API调用列表（只列接口，链接到详细API文档）
## 开发检查清单（验收标准）
```

### 后端文档

```
后端文档 = 业务流程 + 实现要点 ≠ 完整代码实现
```

| 应该写什么 | 不应该写什么 |
|-----------|------------|
| ✅ 业务流程图 | ❌ 完整Python代码 |
| ✅ 关键设计决策 | ❌ 工具函数实现 |
| ✅ 数据结构定义 | ❌ ORM查询语句 |
| ✅ 伪代码逻辑 | ❌ 异常处理细节 |
| ✅ API调用顺序 | ❌ HTTP客户端封装 |

**后端模块文档模板**：

```markdown
# Module X: 模块名称

> **依赖** | **相关API** | **错误码范围**

## 核心概念（关键术语定义）
## 业务流程（主要流程 + 流程图）
## 数据结构（表格定义）
## 实现要点（关键逻辑伪代码）
## 错误处理（错误码映射）
```

---

## 五、质量检查

### 单个文档检查

- [ ] **行数控制**: 是否 < 500行（模块文档）或 < 200行（页面文档）？
- [ ] **单一职责**: 是否只描述一个模块/页面/功能？
- [ ] **可视化**: 是否使用了图表而非大段文字？
- [ ] **交叉引用**: 是否避免了重复内容，使用了链接引用？
- [ ] **目标明确**: AI读完后是否能清楚知道"要做什么"？

### 整体架构检查

- [ ] **快速导航**: 是否有索引文档帮助快速定位？
- [ ] **分层清晰**: Layer 1/2/3 是否职责明确？
- [ ] **模块完整**: 每个功能是否都有对应的文档？
- [ ] **引用正确**: 文档间的链接是否都有效？

### AI友好性检查

**测试方法**：选择一个开发任务，模拟AI使用文档

1. ✅ 能否在3次点击内找到相关文档？
2. ✅ 相关文档总行数是否 < 1000行？
3. ✅ AI阅读后是否能生成正确代码？
4. ✅ 是否避免了加载无关内容？

---

## 六、编写规范

### 内容规则

| 规则 | 做法 | 反例 | 正例 |
|-----|------|------|------|
| 避免模糊词 | 具体陈述 | ❌ "可能/通常/等等" | ✅ "5秒/每小时/立即" |
| 避免被动语态 | 明确谁做什么 | ❌ "token 需要被处理" | ✅ "系统处理 token" |
| 避免假设 | 陈述前置条件 | ❌ "显然/当然" | ✅ "假设用户已登录" |
| 避免外链依赖 | 核心信息直接包含 | ❌ "详见文档 X" | ✅ 在本文档中说明 |

### 代码与文档分工

| 属于文档 | 属于代码 |
|---------|---------|
| 结构和格式（表结构、JSON 格式） | 函数实现 |
| 流程骨架（if-else、循环逻辑） | 真实调用链 |
| 伪代码（描述算法步骤） | 性能优化 |
| API 规范（参数、返回值） | 错误处理实现 |

**文档中严格禁止**：
- ❌ 完整的函数体或类定义
- ❌ 真实的代码实现
- ❌ 导入语句、库调用、框架用法
- ❌ 大量代码块（超过 10 行）

---

## 七、文档维护

### 修改原则

**发现问题时**：
- 直接修改源文档
- 相关联的文档同步更新
- ❌ 不添加变更说明
- ❌ 不保留历史记录

**变更范围**：
- 仅修改受影响的部分
- 删除过时信息
- 保持一致性

### 禁止项

❌ 版本号 / 变更日志
❌ "为什么不选 XXX"（除非关键权衡）
❌ "待办" / "TODO" / "后续确认"
❌ 设计演变历程
❌ 过度引用（最多 2-3 个跳转）


### 文档联动

**任何修改都可能触发其他文档的连锁更新，修改文档时自动检查相关联的文档**

#### 常见变更的联动关系

| 修改内容 | 在文档 | 需要同步更新 | 理由 |
|---------|------|-----------|------|
| 核心实体/流程改变 | 系统模型 | 数据设计、后端、前端、API | 业务基础变了 |
| 数据表字段增删 | 数据设计 | 系统模型、后端、前端、API | 数据结构改了 |
| API 参数/响应格式改变 | 接口定义 | 前端、后端、数据设计 | 交互契约改了 |
| 权限/角色规则改变 | 系统模型 | 后端、前端、数据设计 | 业务逻辑改了 |
| 性能约束改变 | 系统模型 或 全景文档 | 数据设计、后端、前端、API | 非功能需求改了 |
| 复杂流程变更 | 复杂流程文档 | 后端、系统模型 | 细节流程改了 |

#### 修改检验清单

- [ ] 修改内容会影响数据结构吗？→ 更新数据设计文档
- [ ] 修改内容会影响 API 合同吗？→ 更新接口定义文档
- [ ] 修改内容会影响业务流程吗？→ 更新系统模型文档
- [ ] 修改内容会影响前后端实现吗？→ 更新实现指南文档
- [ ] 修改内容会影响权限或约束吗？→ 检查所有相关文档

#### 联动原则

- ✅ **主动同步** - 发现相关文档过时，立即更新
- ✅ **全量一致** - 不能留下任何不一致的状态
- ✅ **完整更新** - 修改不完整时，不发布不一致的文档
- ❌ **不留中间态** - 文档必须始终保持一致

---

## 八、最佳实践

1. **先写文档，再写代码**：文档即需求，AI根据文档生成代码
2. **文档即产品需求**：后端文档=技术PRD，前端文档=UI设计稿+交互说明书
3. **定期重构文档**：每季度检查超长文档、重复内容、过时内容
4. **团队协作规范**：提交代码时同时更新相关文档，检查链接有效性

---

## 九、总结

**AI编程文档的黄金法则**：

```
1. 模块化：< 500行/文档
2. 单一职责：一个文档一个功能
3. 精准相关：只给AI需要的内容
4. 可视化：图表 > 文字
5. 前端界面：交互流程 > 技术实现
6. 后端逻辑：业务流程 > 代码细节
```

**最终目标**：让AI像人类开发者一样理解需求，而不是像搜索引擎一样检索信息

**核心设计原则**：

| 维度 | 要求 |
|-----|------|
| 内容 | 具体 > 抽象 |
| 排版 | 表格/列表/伪代码/流程图 > 段落 |
| 精度 | 数字 > 描述 |
| 独立性 | 一个文档 = 一个决策单位 |
| 维护 | 直接替换，无历史 |
| 可读性 | AI 独立可执行 |

---
