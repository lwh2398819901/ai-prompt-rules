# 📚 AI 驱动开发的文档编写规则体系

## 🎯 核心原则

### 原则 1：信息密度优先
- **目标**：每一行都必须被读到
- **执行**：避免冗余和废话，选择合适的表现形式（表格/列表/伪代码/流程图）
- **反例**：❌ 长段落叙述相同信息
- **正例**：✅ 根据内容特点选择最合适的表达形式

### 原则 2：单一职责
- **目标**：每个文档有唯一明确的用途
- **执行**：一旦职责重叠，拆分或合并
- **检验**：读者看完这个文档，是否只能做一件事的决策

### 原则 3：完全自洽
- **目标**：AI 读一个文档就能独立工作
- **执行**：必要信息直接包含，不依赖隐性假设
- **例外**：第三方官方文档可外链

### 原则 4：直接替换，无历史
- **目标**：修改时直接覆盖，不留版本记录
- **执行**：删除过时信息，不添加变更说明
- **理由**：Git 已记录历史，文档无须重复

---

## 📋 文档分层结构

### 概念

**分层的目的**：让不同角色快速定位自己需要的文档

**分层的原则**：
- 上层是输入，下层依赖上层
- 同层文档相对独立
- 不允许跨层引用（除非是可选）

---

### 第 0 层：全景文档

| 职责 | 大小 | 频率 |
|-----|------|------|
| 项目的核心背景、边界、技术栈 | 0.5-1 页 | 启动时编写，极少修改 |

**组成部分**：
- 项目名 + 一句话定义
- 核心数字（规模、性能要求、数据量级）
- 系统边界（输入、输出、职责范围）
- 技术栈选择 + 理由

**不包含**：业务流程、API 定义、代码组织

---

### 第 1 层：业务层

| 文档 | 职责 | 大小 | 何时需要 |
|-----|------|------|---------|
| **系统模型文档** | 定义核心概念、实体关系、流程、权限、约束 | 2-5 页 | 总是必需 |
| **复杂流程文档** | 处理时序敏感、并发冲突、异常分支 | 1-3 页 | 仅当流程复杂 |

**什么时候不需要复杂流程文档**：
- 流程是线性、无分支的
- 没有时序依赖或并发问题
- 异常处理很直接

---

### 第 2 层：实现层

| 文档 | 职责 | 大小 | 读者 |
|-----|------|------|------|
| **数据设计文档** | 数据结构 + 业务约束，DDL 级别 | 3-8 页 | 所有人 |
| **后端实现指南** | 代码组织、核心算法、外部依赖 | 3-10 页 | 后端 |
| **前端实现指南** | 页面结构、交互流、调用规则 | 2-8 页 | 前端 |
| **接口定义文档** | 前后端契约 | 2-5 页 | 前后端 |

**这些文档的共同特点**：
- 可以直接指导编码工作
- 包含具体的、可执行的决策
- 不重复其他文档的内容

---

## 📐 编写规范

### 排版规则

**使用合适的表现形式**

根据内容特点选择最合适的形式，而不是强制使用单一形式：

| 内容类型 | 推荐形式 | 适用场景 | 示例 |
|---------|---------|---------|------|
| 对比、分类、枚举 | 表格 | 多维度对比、配置项、映射关系 | 方案对比、配置说明 |
| 步骤、要点、清单 | 列表 | 线性流程、要点总结 | 操作步骤、检查清单 |
| 算法逻辑、条件分支 | 伪代码 | 复杂逻辑、算法步骤 | 业务流程、条件判断 |
| 时序、状态转换 | 流程图 | 多路径流程、状态机 | 业务流程、状态转换 |
| 单一决策 | 决策格式 | 技术选型、设计决策 | 选择理由说明 |

**选择原则**：
- 信息密度高 → 表格
- 线性顺序 → 列表
- 复杂逻辑 → 伪代码
- 多路径流程 → 流程图
- 结构化对比 → 表格

**示例对比**：

❌ 纯文本描述：
```
"系统支持 A 方案用于场景 X，B 方案用于场景 Y..."
```

✅ 表格形式（适合对比）：
```
| 场景 | 方案 | 原因 |
|-----|------|------|
| X | A | 理由 |
| Y | B | 理由 |
```

✅ 伪代码形式（适合复杂逻辑）：
```
if 场景 == X:
  使用方案A
elif 场景 == Y:
  使用方案B
```

**决策表达格式**
```
**决策**：[选择什么]
**理由**：
- 理由 1
- 理由 2
```

---

### 内容规则

| 规则 | 做法 | 反例 | 正例 |
|-----|------|------|------|
| 避免模糊词 | 具体陈述 | ❌ "可能/通常/等等" | ✅ "5秒/每小时/立即" |
| 避免被动语态 | 明确谁做什么 | ❌ "token 需要被处理" | ✅ "系统处理 token" |
| 避免假设 | 陈述前置条件 | ❌ "显然/当然" | ✅ "假设用户已登录" |
| 避免外链依赖 | 核心信息直接包含 | ❌ "详见文档 X" | ✅ 在本文档中说明 |
| 条件表达 | 明确场景和行为 | ❌ "系统可能需要 X" | ✅ "系统在情况 Y 下执行 X" |

---

### 代码与文档的分工

| 属于文档 | 属于代码 |
|---------|---------|
| 结构和格式（表结构、JSON 格式） | 函数实现 |
| 流程骨架（if-else、循环逻辑） | 真实调用链 |
| 伪代码（描述算法步骤） | 性能优化 |
| API 规范（参数、返回值） | 错误处理实现 |
| 配置示例（配置项含义） | 库和框架用法 |

**记住**：文档是给 AI 和人类 **读** 的，代码是给编译器/解释器 **执行** 的。

**只在以下情况使用代码**：
- 配置文件格式
- 数据模型定义（DDL、Schema）
- API 请求/响应格式
- 伪代码表示算法

**严格禁止**：
- ❌ 完整的函数体或类定义
- ❌ 真实的代码实现
- ❌ 生产级代码示例
- ❌ 导入语句、库调用、框架用法
- ❌ 大量代码块（超过 10 行）
- ❌ 业务逻辑流程的代码化

**伪代码示例**（✅ 正确）：
```
if 条件A:
  执行步骤1
  执行步骤2
else:
  执行步骤3
```

---

## ✅ 文档质量检查清单

发布前检查：

- [ ] 是否一次能读完（<20 分钟）？
- [ ] 是否选择了合适的表现形式（表格/列表/伪代码/流程图）？
- [ ] 有无模糊词汇？
- [ ] 每个决策都有理由？
- [ ] AI 读完能独立工作？
- [ ] 有无可以内嵌的外链？
- [ ] 有无过时内容需删除？

---

## 🔄 文档维护策略

### 修改原则

**发现问题时**：
- 直接修改源文档
- 相关联的文档同步更新
- ❌ 不添加变更说明
- ❌ 不保留历史记录

**变更范围**：
- 仅修改受影响的部分
- 删除过时信息
- 保持一致性

### 禁止项

❌ 版本号 / 变更日志
❌ "为什么不选 XXX"（除非关键权衡）
❌ "待办" / "TODO" / "后续确认"
❌ 设计演变历程
❌ 过度引用（最多 2-3 个跳转）

---

## 🔗 文档联动原则

**任何修改都可能触发其他文档的连锁更新，修改文档时自动检查相关联的文档**

### 常见变更的联动关系

| 修改内容 | 在文档 | 需要同步更新 | 理由 |
|---------|------|-----------|------|
| 核心实体/流程改变 | 系统模型 | 数据设计、后端、前端、API | 业务基础变了 |
| 数据表字段增删 | 数据设计 | 系统模型、后端、前端、API | 数据结构改了 |
| API 参数/响应格式改变 | 接口定义 | 前端、后端、数据设计 | 交互契约改了 |
| 权限/角色规则改变 | 系统模型 | 后端、前端、数据设计 | 业务逻辑改了 |
| 性能约束改变 | 系统模型 或 全景文档 | 数据设计、后端、前端、API | 非功能需求改了 |
| 复杂流程变更 | 复杂流程文档 | 后端、系统模型 | 细节流程改了 |

### 修改检验清单

- [ ] 修改内容会影响数据结构吗？→ 更新数据设计文档
- [ ] 修改内容会影响 API 合同吗？→ 更新接口定义文档
- [ ] 修改内容会影响业务流程吗？→ 更新系统模型文档
- [ ] 修改内容会影响前后端实现吗？→ 更新实现指南文档
- [ ] 修改内容会影响权限或约束吗？→ 检查所有相关文档

### 联动原则

- ✅ **主动同步** - 发现相关文档过时，立即更新
- ✅ **全量一致** - 不能留下任何不一致的状态
- ✅ **完整更新** - 修改不完整时，不发布不一致的文档
- ❌ **不留中间态** - 文档必须始终保持一致

---

## 核心设计原则总结

| 维度 | 要求 |
|-----|------|
| **内容** | 具体 > 抽象 |
| **排版** | 选择合适形式（表格/列表/伪代码/流程图）> 段落 |
| **精度** | 数字 > 描述 |
| **独立性** | 一个文档 = 一个决策单位 |
| **维护** | 直接替换，无历史 |
| **可读性** | AI 独立可执行 |
| **结构** | 按信息类型分层 > 按角色划分 |

