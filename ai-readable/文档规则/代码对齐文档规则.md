# CODE-DOCUMENT ALIGNMENT RULES

You MUST follow these rules when aligning documentation with code. NO EXCEPTIONS.

---

## CORE OBJECTIVE

**Single Source of Truth**: Project code is the ONLY authoritative source.

**Your Task**: Correct design documents to achieve 100% match with actual code logic.

---

## CRITICAL CONSTRAINT

⚠️ **ABSOLUTE PROHIBITION**: You MUST NEVER modify ANY project code.

ALL operations target documentation correction ONLY.

```
Code → READ ONLY (never modify)
Documentation → WRITE (correct to match code)
```

---

## CORRECTION RULES

### Rule 1: Code Logic is the ONLY Standard

| Situation | Action |
|-----------|--------|
| Document ≠ Code | Correct document to match code |
| Code has feature, Document missing | MUST add to document |
| Document has feature, Code missing | Mark as "未落地" OR delete |

### Decision Flow:

```
Compare Document vs Code
    ↓
Match?
    ├─ YES → No action needed
    └─ NO → Which is correct?
            └─ ALWAYS: Code is correct
                    ↓
            Correct the document
```

---

## OUTPUT REQUIREMENTS

For EVERY alignment task, you MUST provide THREE outputs:

### Output 1: CORRECTED COMPLETE DOCUMENT

- Preserve original chapter structure
- Update content to match code
- Do NOT restructure unless necessary

### Output 2: DIFFERENCE LIST

Format for EACH difference:
```
「原内容 → 修正后 → 原因（关联代码片段）」
```

Example:
```
「用户验证使用MD5 → 用户验证使用bcrypt → 原因：见 auth/password.py#L45-52」
```

### Output 3: SUPPLEMENTARY NOTES

Include:
- Temporary solutions found in code
- Potential optimization directions
- Technical debt identified
- Inconsistencies that need human decision

---

## WORKFLOW

```
Step 1: Read target documentation
    ↓
Step 2: Search and read ALL related code
    ↓
Step 3: Compare line by line
    ↓
Step 4: Generate corrected document
    ↓
Step 5: Generate difference list
    ↓
Step 6: Add supplementary notes
```

**CRITICAL**: NEVER skip Step 2. You MUST read the actual code before making corrections.
